<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free Music Demixer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            text-align: left;
        }

        .warning {
            background-color: #dbf656;
            color: #3c3c3c;
            padding: 10px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .info {
            background-color: #00ff80;
            color: #3c3c3c;
            padding: 10px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .privacy {
            background-color: #f0c2a3;
            color: #3c3c3c;
            padding: 10px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .fatal {
            background-color: #ffcccccc;
            color: #3c3c3c;
            padding: 10px;
            margin-bottom: 20px;
            font-weight: bold;
            justify-content: left;
        }

        .button {
            display: inline-block;
            padding: 10px 20px;
            font-size: 16px;
            background-color: #a24caf;
            color: #ffffff;
            border: none;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 10px;
        }
        .button[disabled] {
            background-color: grey;
            cursor: not-allowed;
        }

        .progress-container {
            text-align: center;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress-bar-inner {
            height: 100%;
            background-color: #4CAF50;
        }

        .progress-text {
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Free Music Demixer</h1>
        <p>Upload a song to decompose it into bass, drums, vocals, other, and karaoke</p>
        <p>Powered by a near-state-of-the-art AI model, Open-Unmix (UMX-L)</p>
        <div class="privacy">
            All processing is done in the browser; your files are never uploaded or stored anywhere!
            <br>
            <br>
            <a href="https://zenodo.org/record/5069601">weights license</a>, <a href="https://github.com/sevagh/free-music-demixer">source code</a>
            <br>
            tl;dr non-commercial use
            <br>
            <br>
            45 MB of model weights are downloaded automatically on page load
            <br>
            check the console logs for more info
        </div>

        <div class="progress-container">
            <div class="progress-text" id="load-progress-text">Downloading weights...</div>
            <div class="progress-bar">
                <div class="progress-bar-inner" id="load-progress-bar" style="width: 0%"></div>
            </div>
        </div>
        <div class="fatal">
            This task is CPU and memory intensive (up to 4 GB), please be patient!
            <br>
            <br>
            It runs on your browser using WebAssembly
            <br>
            <br>
            Large tracks may crash; try to upload smaller tracks (<=5 min)
        </div>

        <input type="file" id="audio-upload">
        <button id="load-waveform" class="button">Demix song</button>
        <br>
        <div class="progress-container">
            <div class="progress-text" id="inference-progress-text">Model inference...</div>
            <div class="progress-bar">
                <div class="progress-bar-inner" id="inference-progress-bar" style="width: 0%"></div>
            </div>
        </div>
        <div class="info">
            The underlying model is <a href="https://github.com/sigsep/open-unmix-pytorch">Open-Unmix</a> (UMX-L weights), with a slight hit to performance
            due to quantizing and compressing the original 424 MB weights to 45 MB, and omitting post-processing
            <br>
            <br>
            The inference step is compiled to WASM using C++, Eigen3, and Emscripten
        </div>
    </div>

    <script src="umx.js"></script>
    <script src="WavFileEncoder.js" type="module"></script>
    <script src="index.js" type="module"></script>
</body>
</html>
